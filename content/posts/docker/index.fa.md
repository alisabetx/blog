---
title: "کار با RabbitMQ"
slug: "rabbitmq"
date: 2025-02-12T14:00:00+03:30
lastmod: 2025-03-28T14:00:00+03:30
tags: ["rabbitmq", "message queue", "messaging", "ربیت ام کیو"]
description: "با ربیت‌ام‌کیو به صورت عملی کار کنیم"
---

# داکر چیه؟

داکر فقط یه ابزار ساده برای نصب نرم‌افزار نیست؛ بیشتر شبیه یه فلسفه‌ست برای اینکه چطوری برنامه‌ها رو بسازیم، بسته‌بندی کنیم و همه‌جا بدون دردسر اجراشون کنیم.
ایده اصلی اینه که اپلیکیشن رو با تمام وابستگی‌ها و تنظیماتش می‌ذاری داخل یه «کانتینر». این کانتینر دیگه به سیستم‌عامل یا سرور خاصی وابسته نیست، و همین باعث میشه تو هر محیطی – از لپ‌تاپ تا دیتاسنتر – همون‌جوری اجرا بشه. نتیجه؟ دردسرهای قدیمی مثل «روی سیستم من کار می‌کنه، روی سرور نه» عملاً حذف میشن.

به خاطر همین ویژگی‌ها، داکر به یه جزء جدانشدنی برای تیم‌های DevOps، برنامه‌نویسا و کل صنعت نرم‌افزار تبدیل شده. تقریباً همه جا حضور داره.

مزیت مهم‌ترش هم اینه که همکاری بین تیم‌ها رو راحت‌تر می‌کنه. وقتی همه مطمئنن برنامه روی هر ماشین دقیقاً یه خروجی میده، توسعه سریع‌تر میشه، خطاها کمتر میشن و تعامل بین تیم‌ها بهتر پیش میره. حالا اگه داکر رو کنار ابزارهایی مثل Kubernetes بذاری، می‌تونی برنامه‌ها رو در مقیاس خیلی بزرگ مدیریت کنی و زیرساخت‌های پیچیده رو مثل یه سیستم یکپارچه اداره کنی.

# مشکل چی بود؟

یکی از دردسرهای همیشگی برنامه‌نویس‌ها: محیط توسعه و محیط عملیاتی با هم فرق دارن. خیلی وقت‌ها کدی که روی لپ‌تاپ برنامه‌نویس بدون مشکل اجرا میشه، وقتی روی سرور یا محیط واقعی (Production) میره، کلی خطا میده. همون جمله معروف: **«روی سیستم من کار می‌کنه، ولی روی سرور نه!»**

این اختلاف معمولاً به خاطر تفاوت در نسخه‌های کتابخونه‌ها، تنظیمات سیستم‌عامل یا حتی پیکربندی‌های شبکه به‌وجود میاد. نتیجه؟ وقت و انرژی زیادی صرف پیدا کردن دلیل مشکل میشه، فرآیند انتشار کند میشه و آدم‌ها خسته میشن.

داکر دقیقاً برای همین ساخته شده: ایجاد یه محیط یکنواخت و استاندارد که مطمئن بشی برنامه در هر جایی *دقیقاً* مثل به یه شکل اجرا میشه؛ چه روی لپ‌تاپ، چه روی سرور و چه روی کلاود.

## هایپروایزرها (Hypervisors)

https://quera.org/qbox/download/CsmCV3j4PS/1.png

قبل از اینکه ماشین‌های مجازی وارد دنیای فناوری بشن، روی هر سرور فقط یه سیستم‌عامل می‌شد نصب کرد. اگه نیاز به سیستم‌عامل دیگه‌ای بود، باید سخت‌افزار جداگانه می‌خریدیم. مشکل اصلی اینجا بود که کرنل هر سیستم‌عامل به سخت‌افزار وصل میشه و نمی‌شه چند کرنل رو همزمان روی یه ماشین داشت. اینجاست که **هایپروایزر** اومد وسط.

هایپروایزر در واقع یه لایه بین سخت‌افزار و سیستم‌عامل‌هاست. کارش اینه که منابع رو تقسیم کنه و چند سیستم‌عامل رو همزمان روی یه سرور اجرا کنه.

* **نوع اول (Bare Metal):** مستقیم روی سخت‌افزار نصب میشه، سریع‌تره و راندمان بالاتری داره. (مثل VMware ESXi یا Hyper-V)
* **نوع دوم (Hosted):** روی یه سیستم‌عامل میزبان اجرا میشه. نصب و راه‌اندازیش آسون‌تره ولی کمی کندتره. (مثل VirtualBox یا Parallels)

هایپروایزرها هزینه‌ها رو پایین آوردن، تست نرم‌افزارها رو ساده‌تر کردن و اساس کار سرویس‌های ابری مثل AWS و Azure هستن.

اما اینجا یه نکته مهمه: **داکر هایپروایزر نیست.**

داکر به جای ساختن ماشین مجازی، از مفهومی به اسم **کانتینر** استفاده می‌کنه. کانتینر در اصل اپلیکیشن رو با تمام وابستگی‌هاش توی یه محیط ایزوله اجرا می‌کنه، اما همچنان از همون کرنل سیستم‌عامل میزبان کمک می‌گیره. موتور داکر (Docker Engine) این کار رو انجام میده.

محدودیتش هم اینه که کانتینر باید با کرنل میزبان سازگار باشه. یعنی نمی‌تونی روی لینوکس یه کانتینر ویندوزی بالا بیاری یا برعکس. (البته با WSL در ویندوز این محدودیت تا حد زیادی رفع شده و می‌تونی کانتینرهای لینوکسی رو روی ویندوز هم اجرا کنی.)

| ویژگی            | هایپروایزر نوع اول    | هایپروایزر نوع دوم             | داکر                   |
| ---------------- | --------------------- | ------------------------------ | ---------------------- |
| نحوه اجرا        | مستقیم روی سخت‌افزار  | روی سیستم‌عامل میزبان          | روی سیستم‌عامل میزبان  |
| استفاده از منابع | مستقیم از سخت‌افزار   | وابسته به OS میزبان            | وابسته به کرنل میزبان  |
| کاربرد اصلی      | اجرای چند OS کامل     | اجرای چند OS روی یک OS         | اجرای اپ‌ها در کانتینر |
| عملکرد           | بالاترین کارایی       | کندتر از نوع اول               | سریع‌تر از VM          |
| مثال             | ESXi, Hyper-V, Xen    | VirtualBox, VMware Workstation | Docker Engine          |
| ایزوله‌سازی      | سطح سیستم‌عامل        | سطح سیستم‌عامل                 | سطح پردازش             |
| محدودیت‌ها       | نیاز به سخت‌افزار قوی | وابسته به OS میزبان            | فقط کرنل مشابه         |
| مزایا            | سرعت و بهینگی بالا    | راه‌اندازی آسان                | سبک، سریع، ساده        |

https://quera.org/qbox/download/LiSDQjIFBS/4.png

# داکر، راهِ اجرای یکسان نرم افزارها

داکر رو می‌تونی مثل این تصور کنی که کل **آشپزخونه**‌ت – قابلمه‌ها، مواد اولیه و حتی دستور پخت – رو بذاری توی یه جعبه و با خودت هرجا ببری. این جعبه همون **کانتینر**ه. وقتی همه‌چیز داخل کانتینر باشه، دیگه مهم نیست کجا بازش می‌کنی؛ خروجی همیشه یکیه.

## داکر دقیقاً چیه؟

داکر یه **پلتفرم متن‌باز**ه که بهت اجازه میده برنامه‌هاتو توی محیط‌های ایزوله به اسم کانتینر اجرا کنی. کانتینر باعث میشه اپلیکیشن و وابستگی‌هاش از محیط میزبان جدا باشن و این یعنی خبری از دردسرهای ناسازگاری محیط‌ها نیست.

داکر از **مجازی‌سازی در سطح سیستم‌عامل** استفاده می‌کنه. برعکس **ماشین مجازی (VM)** نیازی نداره یه سیستم‌عامل کامل بالا بیاره. همین باعث میشه کانتینرها سبک‌تر و سریع‌تر باشن.

https://quera.org/qbox/download/03U4UGQ8RL/docker_vm.png

# اجزای داکر

* ایمج‌ها (Images): فایل‌های فقط خواندنی که حاوی کد برنامه و وابستگی‌ها هستن.
* کانتینرها (Containers): نسخه‌های در حال اجرا از ایمج‌ها که برنامه‌ها در اون‌ها اجرا میشن.
* داکر انجین (Docker Engine): موتور اصلی داکر که مدیریت کانتینرها رو برعهده داره.
* داکر هاب (Docker Hub): یک سرویس آنلاین برای ذخیره و اشتراک‌گذاری ایمج‌های داکر.

## کانتینر

در گذشته بیشتر نرم‌افزارها با معماری **مونو‌لیتی (Monolithic)** ساخته می‌شدن. همه‌چیز داخل یه سرویس واحد بود: فرآیندها، ماژول‌ها و قابلیت‌ها. همین باعث می‌شد تغییر یا به‌روزرسانی خیلی سخت باشه، چون کل سیستم باید یکجا بسته‌بندی و تحویل تیم عملیاتی می‌شد. تیم Ops هم وظیفه پایدار نگه داشتن این سرویس بزرگ رو بر عهده داشت. این مدل هنوزم تو پروژه‌های کوچیک کاربرد داره، ولی محدودیت‌هاش زیاده.

برای رفع این مشکلات، معماری **مایکروسرویس‌ها (Microservices)** معرفی شد. این معماری یعنی شکستن اون ساختار بزرگ به سرویس‌های کوچیک و مستقل. هر سرویس جداگانه اجرا، به‌روزرسانی و مقیاس‌بندی میشه. نتیجه اینه که تیم‌ها می‌تونن سریع‌تر محصول رو توسعه بدن و همیشه به‌روز نگه دارن. شرکت‌هایی مثل **نتفلیکس، گوگل و آمازون** مدت‌هاست روی این معماری کار می‌کنن.

https://quera.org/qbox/download/wlo5vC1ToE/docker_mono-micro.png

اما این روش هم بی‌دردسر نیست. افزایش تعداد سرویس‌های مستقل، مدیریت رو پیچیده می‌کنه. اینجا نقش **اتوماسیون** خیلی مهم میشه تا بار کاری کاهش پیدا کنه و خطاهای انسانی کمتر بشه.

**داکر** از **کانتینرها (Containers)** برای بسته‌بندی و اجرای برنامه‌ها استفاده می‌کنه. کانتینرها بر پایه‌ی **ایمج‌ها (Images)** ساخته می‌شن که شامل همه اجزای لازم برای اجرای برنامه هستن. اجرای کانتینر رو **داکر انجین (Docker Engine)** مدیریت می‌کنه و مطمئن میشه هر برنامه توی یه محیط ایزوله اجرا بشه.

کانتینرها مستقیماً با **کرنل سیستم‌عامل میزبان** کار می‌کنن و منابعی مثل CPU و RAM رو با بقیه کانتینرها به اشتراک می‌ذارن. با این حال، هر کانتینر منطقی از بقیه جداست. بنابراین مشکل یکی روی بقیه تأثیر نداره.

## اجزای اصلی معماری داکر

* **Docker Desktop:** محیط لینوکس لازم رو با یه VM فراهم می‌کنه.
* **Docker Daemon:** از طریق API با کلاینت داکر در ارتباطه.
* **Containerd:** استاندارد صنعتی برای مدیریت چرخه حیات کانتینرها.
* **Shim API:** واسطه‌ای بین Containerd و Runtime.
* **OCI Runtime:** مسئول Namespaces، Cgroups و تنظیمات امنیتی کانتینر.

کانتینرها با تکیه بر قابلیت‌های هسته لینوکس مثل **Cgroups** و **Namespaces** ایزوله‌سازی منابع و امنیت رو تضمین می‌کنن.

# نصب داکر

**داکر دسکتاپ (Docker Desktop)** بهترین راه برای شروع و کار روزمره با داکر و کانتینرهاست. این ابزار تجربه‌ای کامل از اکوسیستم داکر رو فراهم می‌کنه و بهت دسترسی به آخرین قابلیت‌ها، افزونه‌ها و ابزارهای توسعه داده شده میده.


{{< edit >}}

# منابع {#references}
[RabbitMQ](https://rabbitmq.com/)
[CloudAMQP](https://cloudamqp.com/)